<Project TreatAsLocalProperty="_NoticeGeneratorAssetFileParameter;_NoticeGeneratorNpmListFileParameter">
  
  <Target Name="GenerateNotice" 
          AfterTargets="$(GenerateNoticeAfterTargets)" 
          BeforeTargets="$(GenerateNoticeBeforeTargets)" 
          DependsOnTargets="$(GenerateNoticeDependsOn)"
          Inputs="@(NoticeGeneratorAssetFile);@(NoticeGeneratorNpmListJsonFile)"
          Outputs="$(NoticeGeneratorOutputPath)">
    <Error Condition="!Exists('$(NoticeGeneratorAssemblyPath)')" Text="The notice generator tool assembly does not exist at '$(NoticeGeneratorAssemblyPath)'." />
    <Error Condition="@(NoticeGeneratorAssetFile) == '' and @(NoticeGeneratorNpmListJsonFile) == ''" Text="You must specify at least one NoticeGeneratorAssetFile or NoticeGeneratorNpmListJsonFile item to generate a notice file." />
    <Error Condition="$(NoticeGeneratorOutputPath) == ''" Text="You must set the NoticeGeneratorOutputPath property." />

    <PropertyGroup>
      <_NoticeGeneratorAssetFileParameter Condition="@(NoticeGeneratorAssetFile) != ''">--asset-files @(NoticeGeneratorAssetFile,' ')</_NoticeGeneratorAssetFileParameter>
      <_NoticeGeneratorNpmListFileParameter Condition="@(NoticeGeneratorNpmListJsonFile) != ''">--npm-list-json-files @(NoticeGeneratorNpmListJsonFile,' ')</_NoticeGeneratorNpmListFileParameter>
    </PropertyGroup>

    <Exec 
      Command="dotnet $(NoticeGeneratorAssemblyPath) $(_NoticeGeneratorAssetFileParameter) $(_NoticeGeneratorNpmListFileParameter) --output-file $(NoticeGeneratorOutputPath)"
      WorkingDirectory="$(MSBuildProjectDirectory)" />
  </Target>
</Project>